name: Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write
  actions: write

jobs:
  release:
    uses: carr-james/eurorack-workflows/.github/workflows/kicad-build.yml@main
    with:
      project-name: 'Quad VCA Mixer'
      build-type: 'release'
      boards: |
        [
          {
            "name": "front-panel",
            "kibot_config": ".kibot/jlcpcb-2layer.kibot.yaml",
            "pcb_path": "hardware/front-panel/front-panel.kicad_pcb",
            "sch_path": "hardware/front-panel/front-panel.kicad_sch"
          },
          {
            "name": "control-board",
            "kibot_config": ".kibot/jlcpcb-2layer.kibot.yaml",
            "pcb_path": "hardware/control-board/control-board.kicad_pcb",
            "sch_path": "hardware/control-board/control-board.kicad_sch"
          },
          {
            "name": "middle-board",
            "kibot_config": ".kibot/jlcpcb-4layer.kibot.yaml",
            "pcb_path": "hardware/middle-board/middle-board.kicad_pcb",
            "sch_path": "hardware/middle-board/middle-board.kicad_sch"
          },
          {
            "name": "bottom-board",
            "kibot_config": ".kibot/jlcpcb-4layer.kibot.yaml",
            "pcb_path": "hardware/bottom-board/bottom-board.kicad_pcb",
            "sch_path": "hardware/bottom-board/bottom-board.kicad_sch"
          }
        ]
      skip-checks: 'erc,drc'
      include-assembly-files: true
